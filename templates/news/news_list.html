{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">üì∞ –°–ø–∏—Å–æ–∫ –Ω–æ–≤–æ—Å—Ç–µ–π</h1>


    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑ view -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <h5 class="card-title">–í—Å–µ–≥–æ –Ω–æ–≤–æ—Å—Ç–µ–π</h5>
                    <p class="card-text display-6">{{ total_count }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h5 class="card-title">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</h5>
                    <p class="card-text display-6">{{ published_count }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h5 class="card-title">–ß–µ—Ä–Ω–æ–≤–∏–∫–∏</h5>
                    <p class="card-text display-6">{{ draft_count }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –Ω–æ–≤–æ—Å—Ç–µ–π -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏</h5>
            <a href="{% url 'create_news' %}" class="btn btn-success btn-sm">
                ‚ú® –ù–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å
            </a>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 5%">ID</th>
                            <th style="width: 20%">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th style="width: 10%">–ú–µ–¥–∏–∞</th>
                            <th style="width: 15%">–î–∞—Ç–∞</th>
                            <th style="width: 10%">–°—Ç–∞—Ç—É—Å</th>
                            <th style="width: 25%">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                            <th style="width: 15%">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for post in posts %}
                        <tr class="{% if post.is_published %}table-success{% else %}table-warning{% endif %}">
                            <!-- ID -->
                            <td><strong>#{{ post.id }}</strong></td>

                            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
                            <td>
                                <div class="fw-bold">{{ post.title|truncatechars:30 }}</div>
                                <small class="text-muted">
                                    {{ post.content|truncatechars:40|default:"–ë–µ–∑ —Ç–µ–∫—Å—Ç–∞" }}
                                </small>
                            </td>

                            <!-- –ú–µ–¥–∏–∞ -->
                            <td>
                                {% if post.video %}
                                    <span class="badge bg-danger">üé¨ –í–∏–¥–µ–æ</span>
                                {% elif post.video_url %}
                                    <span class="badge bg-warning text-dark">üîó –°—Å—ã–ª–∫–∞</span>
                                {% elif post.image %}
                                    <span class="badge bg-info">üì∏ –§–æ—Ç–æ</span>
                                {% else %}
                                    <span class="badge bg-secondary">üìù –¢–µ–∫—Å—Ç</span>
                                {% endif %}
                            </td>

                            <!-- –î–∞—Ç–∞ -->
                            <td>
                                <div><small>–°–æ–∑–¥–∞–Ω–æ:</small></div>
                                <div class="fw-bold">{{ post.created_at|date:"d.m.Y" }}</div>
                                <div><small>{{ post.created_at|date:"H:i" }}</small></div>
                                {% if post.published_at %}
                                <div class="mt-1">
                                    <small class="text-success">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:</small><br>
                                    <small>{{ post.published_at|date:"d.m.Y H:i" }}</small>
                                </div>
                                {% endif %}
                            </td>

                            <!-- –°—Ç–∞—Ç—É—Å -->
                            <td>
                                {% if post.is_published %}
                                    <span class="badge bg-success rounded-pill p-2">
                                        ‚úÖ<br>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
                                    </span>
                                {% else %}
                                    <span class="badge bg-warning rounded-pill p-2">
                                        üìã<br>–ß–µ—Ä–Ω–æ–≤–∏–∫
                                    </span>
                                {% endif %}
                            </td>

                            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
                            <td>
                                {% if post.comment %}
                                    <div class="bg-light p-2 rounded" style="font-size: 0.85em;">
                                        {{ post.comment|linebreaks|truncatechars:100 }}
                                    </div>
                                {% else %}
                                    <span class="text-muted">‚Äî</span>
                                {% endif %}
                            </td>

                            <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                            <td>
                                <div class="btn-group btn-group-sm">
                                    {% if not post.is_published %}
                                    <a href="{% url 'publish_news' post.id %}"
                                       class="btn btn-primary"
                                       title="–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ Telegram">
                                        üì§
                                    </a>
                                    {% endif %}

                                    <a href="/admin/news/newspost/{{ post.id }}/change/"
                                       class="btn btn-outline-secondary"
                                       target="_blank"
                                       title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                        ‚úèÔ∏è
                                    </a>

                                    {% if post.is_published %}
                                    <a href="https://t.me/swmnews"
                                       class="btn btn-outline-success"
                                       target="_blank"
                                       title="–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ Telegram">
                                        üëÅÔ∏è
                                    </a>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="7" class="text-center py-5">
                                <div class="text-muted">
                                    <h4>üì≠ –ù–æ–≤–æ—Å—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</h4>
                                    <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –Ω–æ–≤–æ—Å—Ç—å!</p>
                                    <a href="{% url 'create_news' %}" class="btn btn-success">
                                        –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –Ω–æ–≤–æ—Å—Ç—å
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
.table th {
    background-color: #f8f9fa;
    font-weight: 600;
}
.badge {
    font-size: 0.8em;
}
.table-success {
    background-color: rgba(25, 135, 84, 0.05) !important;
}
.table-warning {
    background-color: rgba(255, 193, 7, 0.05) !important;
}
</style>
{% endblock %}